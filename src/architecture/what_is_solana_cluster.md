# 什么是Solana集群？

## Solana 集群

Solana 集群是一组协同工作的验证器，为客户交易提供服务并维护账本的完整性。许多集群可以共存。当两个集群共享一个共同的创世块时，它们会尝试收敛。否则，他们根本无视对方的存在。发送到错误的交易会被悄悄拒绝。在本节中，我们将讨论如何创建集群、节点如何加入集群、它们如何共享账本、它们如何确保账本被复制，以及它们如何应对错误和恶意节点。

## 创建集群


在启动任何验证器之前，首先需要创建一个创世配置。该配置引用了两个公钥，一个 mint 和一个引导程序验证器。持有引导程序验证器私钥的验证器负责将第一个条目添加到账本中。它使用铸币厂的账户初始化其内部状态。该帐户将持有创世配置定义的原生代币数量。第二个验证器然后联系引导程序验证器以注册为验证器。然后，其他验证器向集群的任何已注册成员注册。

验证器接收来自领导者的所有条目并提交确认这些条目有效的投票。投票后，验证者应存储这些条目。一旦验证器观察到存在足够数量的副本，它就会删除其副本。

## 加入集群

验证者通过发送到其控制平面的注册消息进入集群。控制平面是使用八卦协议实现的，这意味着一个节点可以向任何现有节点注册，并期望其注册传播到集群中的所有节点。所有节点同步所需的时间与参与集群的节点数的平方成正比。从算法上讲，这被认为是非常慢的，但是作为时间的交换，一个节点可以确保它最终拥有与所有其他节点相同的所有信息，并且该信息不能被任何一个节点审查。

## 向集群发送交易

客户端将交易发送到任何验证器的交易处理单元 (TPU) 端口。如果节点处于验证者角色，它将事务转发给指定的领导者。如果处于领导者角色，该节点会捆绑传入的事务，为它们创建一个条目并为其添加时间戳，并将它们推送到集群的数据平面上。一旦进入数据平面，交易将由验证节点进行验证，有效地将它们附加到账本中。

## 确认交易

Solana 集群能够对数千个节点进行亚秒级确认，并计划扩展到数十万个节点。预计确认时间只会随着验证者数量的对数增加，其中对数的底数非常高。例如，如果基数是一千，这意味着对于前一千个节点，确认将是三个网络跃点的持续时间加上绝对多数中最慢的验证者投票所花费的时间。对于接下来的一百万个节点，确认只会增加一个网络跃点。

Solana 将确认定义为从领导者为新条目添加时间戳到它识别出绝大多数分类帐投票的那一刻的持续时间。

使用以下技术组合可以实现可扩展的确认：

- 带有 VDF 样本的时间戳交易并签署时间戳。
- 将事务分成批次，将每个事务发送到单独的节点，并让每个节点与其对等节点共享其批次。
- 递归地重复上一步，直到所有节点都拥有所有批次。

Solana 以固定的时间间隔轮换领导者，称为时隙。每个领导者只能在其分配的时隙内产生条目。因此，领导者为交易打上时间戳，以便验证者可以查找指定领导者的公钥。然后领导者签署时间戳，以便验证者可以验证签名，证明签名者是指定领导者公钥的所有者。

接下来，交易被分成批次，这样一个节点就可以将交易发送给多方而无需制作多个副本。例如，如果领导者需要向 6 个节点发送 60 笔交易，它将把这 60 笔交易分成 10 笔交易的批次，并向每个节点发送一个。这允许领导者在线上放置 60 笔交易，而不是每个节点 60 笔交易。然后每个节点与其对等节点共享其批次。一旦节点收集了所有 6 个批次，它就会重建原始的 60 个交易集。

一批交易在小到头部信息成为网络带宽的主要消费者之前只能拆分这么多次。在撰写本文时（2021 年 12 月），该方法正在扩展到大约 1,250 个验证器。为了扩展到数十万个验证器，每个节点都可以将与领导节点相同的技术应用于另一组相同大小的节点。我们称该技术为涡轮机块传播。
